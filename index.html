
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  <title>Neon One: 1000 Unique Puzzles</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Outfit', sans-serif;
      background-color: #000;
      color: #fff;
      margin: 0;
      padding: 0;
      overflow: hidden;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      height: 100dvh;
    }
    #root { height: 100%; width: 100%; }
    .bg-grid {
      background-image: radial-gradient(circle at 1px 1px, #ffffff05 1px, transparent 0);
      background-size: 30px 30px;
    }
    .neon-glow { filter: drop-shadow(0 0 15px var(--neon-color)); }
    .hint-active { animation: hint-flash 0.6s infinite alternate; }
    @keyframes hint-flash {
      from { stroke: #facc15; opacity: 0.3; stroke-width: 22; }
      to { stroke: #fff; opacity: 1; stroke-width: 32; }
    }
    .btn-press:active { transform: scale(0.95); transition: 0.1s; }
    .win-pop { animation: win-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes win-pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    
    #loader {
      position: fixed; inset: 0; background: #000; z-index: 9999;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .spinner { width: 40px; height: 40px; border: 4px solid #111; border-top-color: #00f2ff; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Professional Ad Styling */
    .ad-banner {
        background: rgba(255,255,255,0.03);
        border: 1px dashed rgba(255,255,255,0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #444;
        font-size: 10px;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 2px;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>
</head>
<body class="bg-grid">
  <div id="loader">
    <div class="spinner"></div>
    <p style="margin-top: 20px; font-size: 10px; color: #444; letter-spacing: 0.5em; font-weight: 900; text-transform: uppercase;">Building Unique Worlds...</p>
  </div>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    const STORAGE_KEY = 'neon_one_final_v1000';
    const COLORS = ["#00f2ff", "#ff00ff", "#facc15", "#22c55e", "#a855f7", "#ef4444", "#3b82f6"];

    const createRandom = (seed) => {
      let s = seed;
      return () => {
        s = (s * 9301 + 49297) % 233280;
        return s / 233280;
      };
    };

    const generateLevel = (lvl) => {
      const rng = createRandom(lvl * 1337);
      const theme = COLORS[lvl % COLORS.length];
      
      // Node count increases slowly with levels to maintain fairness but add challenge
      const nodeCount = Math.min(25, 5 + Math.floor(lvl / 50));
      const edgeTarget = Math.min(60, 6 + Math.floor(lvl / 12));
      
      let nodes = [];
      let edges = [];
      let pathOrder = []; 

      // Create Nodes
      for (let i = 0; i < nodeCount; i++) {
        let x, y;
        if (lvl % 4 === 0) { // Spiral Pattern
          const angle = (i / nodeCount) * Math.PI * 4;
          const r = 50 + (i / nodeCount) * 120;
          x = 200 + Math.cos(angle) * r;
          y = 200 + Math.sin(angle) * r;
        } else if (lvl % 4 === 1) { // Concentric
          const angle = (i / (nodeCount/2)) * Math.PI * 2;
          const r = i < nodeCount/2 ? 80 : 150;
          x = 200 + Math.cos(angle) * r;
          y = 200 + Math.sin(angle) * r;
        } else { // Chaos Layout
          x = 70 + rng() * 260;
          y = 70 + rng() * 260;
        }
        nodes.push({ id: i, x, y });
      }

      // Trace Solution Path (Eulerian)
      let curr = Math.floor(rng() * nodeCount);
      pathOrder.push(curr);
      const edgeMap = new Set();

      for (let i = 0; i < edgeTarget; i++) {
        let possibleNext = nodes.filter(n => n.id !== curr).sort(() => rng() - 0.5);
        let next = possibleNext[0].id;
        const key = [curr, next].sort().join('-');
        
        if (edgeMap.has(key)) {
            const unused = possibleNext.find(n => !edgeMap.has([curr, n.id].sort().join('-')));
            if (unused) next = unused.id;
        }

        const finalKey = [curr, next].sort().join('-');
        if (!edgeMap.has(finalKey)) {
          edgeMap.add(finalKey);
          edges.push({ from: curr, to: next });
        }
        curr = next;
        pathOrder.push(curr);
      }

      return { nodes, edges, theme, title: `Level ${lvl}`, solution: pathOrder };
    };

    const App = () => {
      const [levelNum, setLevelNum] = useState(1);
      const [view, setView] = useState('MENU');
      const [level, setLevel] = useState(null);
      const [current, setCurrent] = useState(null);
      const [used, setUsed] = useState(new Set());
      const [drawing, setDrawing] = useState(false);
      const [pos, setPos] = useState({ x: 0, y: 0 });
      const [hint, setHint] = useState(null);
      const [ad, setAd] = useState(null);
      const containerRef = useRef(null);

      useEffect(() => {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) setLevelNum(parseInt(saved));
        setTimeout(() => document.getElementById('loader').style.display = 'none', 800);
      }, []);

      const initLevel = useCallback((num) => {
        const data = generateLevel(num);
        setLevel(data);
        setUsed(new Set());
        setCurrent(null);
        setHint(null);
        setView('GAME');
        localStorage.setItem(STORAGE_KEY, num.toString());
      }, []);

      useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [view, ad, levelNum]);

      const handlePointer = (e) => {
        if (!level || view !== 'GAME') return;
        const rect = containerRef.current.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const x = ((clientX - rect.left) / rect.width) * 400;
        const y = ((clientY - rect.top) / rect.height) * 400;
        setPos({ x, y });

        if (e.type === 'mousedown' || e.type === 'touchstart') setDrawing(true);

        if (drawing || e.type === 'mousedown' || e.type === 'touchstart') {
          for (const n of level.nodes) {
            const d = Math.sqrt((n.x - x)**2 + (n.y - y)**2);
            if (d < 30) {
              if (current === null) {
                setCurrent(n.id);
              } else if (n.id !== current) {
                const key = [current, n.id].sort().join('-');
                const edge = level.edges.find(ed => (ed.from === current && ed.to === n.id) || (ed.from === n.id && ed.to === current));
                if (edge && !used.has(key)) {
                  const nextUsed = new Set(used).add(key);
                  setUsed(nextUsed);
                  setCurrent(n.id);
                  setHint(null);
                  if (nextUsed.size === level.edges.length) setTimeout(() => setView('WIN'), 300);
                }
              }
              break;
            }
          }
        }
      };

      const triggerHint = () => {
        if (current === null) {
          setHint({ from: level.solution[0], to: level.solution[1] });
        } else {
          const nextEdge = level.edges.find(e => {
            const key = [e.from, e.to].sort().join('-');
            return (e.from === current || e.to === current) && !used.has(key);
          });
          if (nextEdge) setHint(nextEdge);
        }
      };

      if (view === 'MENU') return (
        <div className="h-full bg-black flex flex-col items-center justify-between p-10 pb-20">
          <div className="pt-24 text-center">
            <h1 className="text-[90px] font-black italic tracking-tighter leading-[0.6] text-white">NEON<br/><span className="text-zinc-800 text-[70px]">ONE</span></h1>
            <p className="mt-14 text-zinc-700 font-black uppercase tracking-[0.5em] text-[10px]">1000 LEVELS ACTIVE</p>
          </div>
          <div className="w-full flex flex-col items-center gap-12">
            <button onClick={() => initLevel(levelNum)} className="w-full max-w-[320px] bg-white text-black py-10 rounded-[4rem] font-black text-6xl btn-press shadow-2xl italic">PLAY</button>
            <div className="flex flex-col items-center gap-4">
              <span className="text-zinc-500 font-black uppercase text-sm tracking-widest">CONTINUE LVL {levelNum}</span>
            </div>
          </div>
          <div className="w-full h-16 ad-banner rounded-2xl">AdMob Banner Placeholder</div>
        </div>
      );

      return (
        <div className="h-full bg-black flex flex-col items-center justify-between pb-8" style={{"--neon-color": level?.theme}}>
          <div className="w-full px-8 pt-14 flex justify-between items-center">
            <button onClick={() => setView('MENU')} className="p-4 bg-zinc-900/40 rounded-2xl text-white btn-press border border-white/5"><i data-lucide="home" size={24}></i></button>
            <div className="flex flex-col items-center">
              <div className="bg-zinc-900 px-10 py-3 rounded-full text-white font-black italic tracking-widest text-2xl border border-white/10 shadow-xl" style={{borderColor: level?.theme+'44'}}>LVL {levelNum}</div>
              <span className="text-[10px] font-black mt-2 tracking-[0.4em] uppercase" style={{color: level?.theme}}>UNIQUE PUZZLE</span>
            </div>
            <button onClick={() => { setUsed(new Set()); setCurrent(null); setHint(null); }} className="p-4 bg-zinc-900/40 rounded-2xl text-white btn-press border border-white/5"><i data-lucide="refresh-cw" size={24}></i></button>
          </div>

          <div ref={containerRef} className="relative bg-[#050505] rounded-[5rem] border border-white/5 overflow-hidden" 
               style={{ width: 'min(92vw, 420px)', height: 'min(92vw, 420px)' }}
               onMouseDown={handlePointer} onMouseMove={handlePointer} onMouseUp={() => setDrawing(false)}
               onTouchStart={handlePointer} onTouchMove={handlePointer} onTouchEnd={() => setDrawing(false)}>
            <svg width="100%" height="100%" viewBox="0 0 400 400" className="pointer-events-none">
              {level?.edges.map((e, i) => {
                const n1 = level.nodes.find(n => n.id === e.from);
                const n2 = level.nodes.find(n => n.id === e.to);
                const isUsed = used.has([e.from, e.to].sort().join('-'));
                const isHint = hint && ((hint.from === e.from && hint.to === e.to) || (hint.from === e.to && hint.to === e.from));
                return <line key={i} x1={n1.x} y1={n1.y} x2={n2.x} y2={n2.y} 
                             stroke={isUsed ? level.theme : (isHint ? "#facc15" : "#141414")} 
                             strokeWidth={isUsed ? "26" : "22"} strokeLinecap="round" 
                             className={isUsed ? "neon-glow" : (isHint ? "hint-active" : "")} />;
              })}
              {drawing && current !== null && (
                <line x1={level.nodes.find(n => n.id === current).x} y1={level.nodes.find(n => n.id === current).y} x2={pos.x} y2={pos.y} stroke={level.theme + "44"} strokeWidth="14" strokeDasharray="12,12" />
              )}
              {level?.nodes.map(n => (
                <circle key={n.id} cx={n.x} cy={n.y} r="22" 
                        fill={current === n.id ? "#fff" : "#0c0c0c"} 
                        stroke={current === n.id ? level.theme : "#222"} 
                        strokeWidth="6" className={current === n.id ? "neon-glow" : ""} />
              ))}
            </svg>
          </div>

          <div className="w-full flex flex-col gap-4 px-8 max-w-[460px]">
            <div className="flex gap-4">
              <button onClick={() => setAd('HINT')} className="flex-1 bg-zinc-900/40 py-8 rounded-[2.5rem] flex items-center justify-center gap-3 text-white font-black uppercase text-[12px] tracking-widest btn-press border border-white/5">
                <i data-lucide="sparkles" size={20}></i> HINT
              </button>
              <button onClick={() => setAd('SKIP')} className="flex-1 bg-zinc-900/40 py-8 rounded-[2.5rem] flex items-center justify-center gap-3 text-white font-black uppercase text-[12px] tracking-widest btn-press border border-white/5">
                <i data-lucide="skip-forward" size={20}></i> SKIP
              </button>
            </div>
            <div className="w-full h-12 ad-banner rounded-xl">Bottom Banner Ad</div>
          </div>

          {ad && (
            <div className="fixed inset-0 bg-black/98 flex flex-col items-center justify-center p-10 z-[2000] backdrop-blur-3xl">
              <div className="bg-zinc-900 border border-white/10 p-12 rounded-[5rem] w-full max-w-[360px] text-center win-pop shadow-2xl">
                <div className="w-20 h-20 bg-indigo-600 rounded-3xl mx-auto mb-8 flex items-center justify-center text-white shadow-xl">
                   <i data-lucide="play" size={40}></i>
                </div>
                <h3 className="text-3xl font-black italic text-white mb-2 uppercase tracking-tight">WATCH REWARD AD</h3>
                <p className="text-zinc-600 text-[10px] font-black mb-10 uppercase tracking-widest">Get your {ad} after video</p>
                <div className="flex flex-col gap-4">
                  <button onClick={() => {
                    if(ad === 'SKIP') { const n = levelNum + 1; setLevelNum(n); initLevel(n); }
                    else { triggerHint(); }
                    setAd(null);
                  }} className="w-full bg-white text-black py-7 rounded-[2rem] font-black text-2xl uppercase btn-press italic">PLAY VIDEO</button>
                  <button onClick={() => setAd(null)} className="text-zinc-700 font-black uppercase text-[10px] p-2">Cancel</button>
                </div>
              </div>
            </div>
          )}

          {view === 'WIN' && (
            <div className="fixed inset-0 bg-black/99 flex flex-col items-center justify-center p-10 z-[1000] backdrop-blur-3xl">
              <div className="flex flex-col items-center win-pop text-center">
                <div className="text-yellow-400 mb-14 scale-[5] drop-shadow-2xl"><i data-lucide="star"></i></div>
                <h2 className="text-[90px] font-black italic text-white mb-2 uppercase tracking-tighter leading-none">CLEARED</h2>
                <div className="w-full h-24 ad-banner rounded-3xl mb-8">Interstitial Ad Slot</div>
                <button onClick={() => { const n = levelNum + 1; setLevelNum(n); initLevel(n); }} 
                  className="w-full min-w-[340px] bg-white text-black py-10 rounded-full text-5xl font-black btn-press shadow-2xl italic">
                  NEXT LEVEL
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
